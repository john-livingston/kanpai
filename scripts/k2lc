#!/usr/bin/env python

import os
import sys
import numpy as np
import matplotlib.pyplot as pl
import argparse
import k2

cwd = os.path.abspath('.')
parser = argparse.ArgumentParser(description="Get phased-folded K2"
    " light curve")
parser.add_argument('epic', help='Target star EPIC id number', type=int)
parser.add_argument('period', help='Period of candidate', type=float)
parser.add_argument('t0', help='Time of first transit', type=float)
parser.add_argument('t14', help='Transit duration', type=float)
parser.add_argument('-o', '--outdir', help='output directory',
    type=str, default=cwd)
parser.add_argument('-p', '--plot', dest='plot', help='make a plot',
    action='store_true')
parser.set_defaults(plot=False)
args = parser.parse_args()

epic = args.epic
p = args.period
t0 = args.t0
t14 = args.t14
outdir = args.outdir
plot = args.plot

if plot:
    pl.plot(tf, ff, 'ko')
    fp = os.path.join(outdir, 'k2_lc_{}.png'.format(epic))
    pl.savefig(fp)
    pl.close()

tf, ff = k2.lc.get_everest_folded(epic, p, t0, t14)
fp = os.path.join(outdir, 'k2_lc_{}.txt'.format(epic))
np.savetxt(fp, np.c_[tf, ff])
